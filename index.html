<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - Pelacak Kebiasaan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#2e8b57',
                        secondary: '#3aab76',
                        dark: '#0f172a',
                        darker: '#0b1120',
                        nature: {
                            100: '#e8f5e9',
                            200: '#c8e6c9',
                            300: '#a5d6a7',
                            400: '#81c784',
                            500: '#66bb6a',
                            600: '#4caf50',
                            700: '#388e3c',
                            800: '#2e7d32',
                            900: '#1b5e20'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .leaf-pattern {
            background-image: radial-gradient(#2e7d32 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.05;
        }
        
        .habit-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(46, 139, 87, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .habit-card::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(58, 171, 118, 0.15) 0%, transparent 60%);
            transform: rotate(30deg);
            pointer-events: none;
        }
        
        .time-slot {
            position: relative;
            border-left: 2px solid;
            padding-left: 12px;
            margin-bottom: 16px;
        }
        
        .time-slot::before {
            content: "";
            position: absolute;
            left: -6px;
            top: 6px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #3aab76;
            box-shadow: 0 0 8px #3aab76;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(58, 171, 118, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(58, 171, 118, 0); }
            100% { box-shadow: 0 0 0 0 rgba(58, 171, 118, 0); }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3aab76;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2e8b57;
        }
        
        .category-badge {
            border-radius: 12px;
            padding: 2px 10px;
            font-size: 0.75rem;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Pattern background -->
    <div class="leaf-pattern fixed inset-0 z-0"></div>
    
    <div class="relative z-10">
        <!-- Header Section -->
        <header class="bg-dark border-b border-nature-800 py-4 px-4 md:px-8 sticky top-0 z-30">
            <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center">
                    <div class="bg-nature-700 rounded-full p-2 mr-3">
                        <i class="fas fa-seedling text-nature-300 text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold bg-gradient-to-r from-nature-300 via-nature-400 to-nature-500 bg-clip-text text-transparent">Pelacak Kebiasaan</h1>
                        <p id="currentDateTime" class="text-sm text-gray-400 flex items-center mt-1">
                            <i class="fas fa-calendar mr-2"></i> 
                            <span id="dateTime"></span>
                        </p>
                    </div>
                </div>
                
                <div class="mt-3 md:mt-0">
                    <button id="resetBtn" class="bg-nature-700 hover:bg-nature-600 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i> Reset Checklist
                    </button>
                </div>
            </div>
        </header>
        
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- Statistics Section -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-chart-pie text-nature-400 mr-3"></i> Statistik Kebiasaan
                </h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-darker rounded-xl p-6 habit-card">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-layer-group text-nature-300 mr-2"></i> Distribusi Kategori
                        </h3>
                        <div class="h-64">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-darker rounded-xl p-6 habit-card">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-tasks text-nature-300 mr-2"></i> Persentase Penyelesaian
                        </h3>
                        <div class="h-64">
                            <canvas id="completionChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Habits Section -->
            <section class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-list-check text-nature-400 mr-3"></i> Daftar Kebiasaan
                    </h2>
                    
                    <button id="openSettingsBtn" class="text-gray-400 hover:text-white transition">
                        <i class="fas fa-gear text-xl"></i>
                    </button>
                </div>
                
                <div id="habitsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Habits will be dynamically inserted here -->
                </div>
                
                <!-- Empty State -->
                <div id="emptyState" class="text-center py-20">
                    <div class="inline-block p-5 rounded-full bg-nature-900/30 mb-4">
                        <i class="fas fa-tree text-nature-500 text-4xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Belum ada kebiasaan</h3>
                    <p class="text-gray-400 mb-4">Mulai tambahkan kebiasaan baru untuk membangun rutinitas yang lebih baik</p>
                    <button id="addHabitBtn" class="bg-nature-700 hover:bg-nature-600 text-white font-medium py-2 px-6 rounded-lg transition flex items-center mx-auto pulse">
                        <i class="fas fa-plus mr-2"></i> Tambah Kegiatan
                    </button>
                </div>
            </section>
        </main>
        
        <!-- Floating Action Button -->
        <button id="fab" class="fixed bottom-8 right-8 bg-nature-700 hover:bg-nature-600 text-white font-bold w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 z-20">
            <i class="fas fa-plus text-xl"></i>
        </button>
        
        <!-- Add Habit Modal -->
        <div id="addModal" class="fixed inset-0 bg-black/70 z-40 flex items-center justify-center hidden">
            <div class="bg-darker rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Tambah Kegiatan Baru</h3>
                        <button id="closeAddModal" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form id="habitForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Judul Kegiatan</label>
                            <input type="text" id="habitTitle" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500" required placeholder="Misal: Olahraga Pagi">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Daftar Kegiatan</label>
                            <div id="tasksContainer">
                                <div class="flex items-center mb-2">
                                    <input type="text" class="flex-grow bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500" placeholder="Deskripsi kegiatan">
                                    <button type="button" class="ml-2 text-red-400 hover:text-red-300 text-lg remove-task-btn">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" id="addTaskBtn" class="mt-2 text-sm text-nature-400 hover:text-nature-300 flex items-center">
                                <i class="fas fa-plus mr-1"></i> Tambah Item
                            </button>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Kategori Waktu</label>
                            <select id="habitCategory" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500">
                                <option value="subuh">Subuh</option>
                                <option value="pagi">Pagi</option>
                                <option value="siang">Siang</option>
                                <option value="sore">Sore</option>
                                <option value="malam">Malam</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Waktu Mulai</label>
                                <input type="time" id="startTime" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Waktu Selesai</label>
                                <input type="time" id="endTime" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500">
                            </div>
                        </div>
                        
                        <div class="flex justify-end pt-4">
                            <button type="button" id="cancelHabit" class="mr-4 px-4 py-2 text-gray-300 hover:text-white">
                                Batal
                            </button>
                            <button type="submit" class="bg-nature-700 hover:bg-nature-600 text-white font-medium py-2 px-6 rounded-lg transition">
                                Simpan
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Settings Modal -->
        <div id="settingsModal" class="fixed inset-0 bg-black/70 z-40 flex items-center justify-center hidden">
            <div class="bg-darker rounded-xl max-w-2xl w-full mx-4">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Pengaturan GitHub</h3>
                        <button id="closeSettingsModal" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form id="githubForm" class="space-y-6">
                        <p class="text-gray-400 text-sm">Untuk menyimpan data secara otomatis ke repository GitHub</p>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Username GitHub</label>
                            <input type="text" id="githubUsername" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500" placeholder="username">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Nama Repository</label>
                            <input type="text" id="githubRepo" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500" placeholder="nama-repository">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Personal Access Token (PAT)</label>
                            <input type="password" id="githubToken" class="w-full bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500" placeholder="PAT token">
                            <p class="text-xs text-gray-500 mt-2">PAT memerlukan izin "repo" untuk menyimpan data</p>
                        </div>
                        
                        <div class="flex justify-end pt-4">
                            <button type="button" id="cancelSettings" class="mr-4 px-4 py-2 text-gray-300 hover:text-white">
                                Batal
                            </button>
                            <button type="submit" class="bg-nature-700 hover:bg-nature-600 text-white font-medium py-2 px-6 rounded-lg transition">
                                Simpan Pengaturan
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Data handling
        let habits = JSON.parse(localStorage.getItem('habits')) || [];
        let githubConfig = JSON.parse(localStorage.getItem('githubConfig')) || null;
        
        // DOM elements
        const habitsContainer = document.getElementById('habitsContainer');
        const emptyState = document.getElementById('emptyState');
        const addModal = document.getElementById('addModal');
        const settingsModal = document.getElementById('settingsModal');
        const dateTimeDisplay = document.getElementById('dateTime');
        const tasksContainer = document.getElementById('tasksContainer');
        const categoryChartCtx = document.getElementById('categoryChart').getContext('2d');
        const completionChartCtx = document.getElementById('completionChart').getContext('2d');
        
        // Chart instances
        let categoryChart;
        let completionChart;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            renderHabits();
            updateCharts();
            
            // Event listeners
            document.getElementById('addHabitBtn').addEventListener('click', openAddModal);
            document.getElementById('fab').addEventListener('click', openAddModal);
            document.getElementById('closeAddModal').addEventListener('click', closeAddModal);
            document.getElementById('openSettingsBtn').addEventListener('click', openSettingsModal);
            document.getElementById('closeSettingsModal').addEventListener('click', closeSettingsModal);
            document.getElementById('cancelHabit').addEventListener('click', closeAddModal);
            document.getElementById('cancelSettings').addEventListener('click', closeSettingsModal);
            document.getElementById('resetBtn').addEventListener('click', resetChecklists);
            document.getElementById('addTaskBtn').addEventListener('click', addTaskField);
            document.getElementById('habitForm').addEventListener('submit', saveHabit);
            document.getElementById('githubForm').addEventListener('submit', saveGithubConfig);
            
            // Attach event delegation for task removal
            tasksContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-task-btn') || e.target.closest('.remove-task-btn')) {
                    const taskItem = e.target.closest('.flex');
                    if (taskItem && tasksContainer.children.length > 1) {
                        taskItem.remove();
                    }
                }
            });
            
            // Delegated events for the habits container
            habitsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('task-checkbox')) {
                    const taskId = e.target.dataset.taskId;
                    const habitId = e.target.closest('.habit-card').dataset.habitId;
                    toggleTask(habitId, parseInt(taskId));
                } else if (e.target.closest('.delete-btn')) {
                    const habitId = e.target.closest('.habit-card').dataset.habitId;
                    deleteHabit(habitId);
                }
            });
        });
        
        // Update date and time display
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' };
            dateTimeDisplay.textContent = now.toLocaleDateString('id-ID', options);
        }
        
        // Reset all task checklists
        function resetChecklists() {
            habits.forEach(habit => {
                habit.tasks.forEach(task => {
                    task.completed = false;
                });
            });
            localStorage.setItem('habits', JSON.stringify(habits));
            renderHabits();
            updateCharts();
            
            // Show notification
            showNotification('Checklist kegiatan telah direset!');
        }
        
        // Add task input field
        function addTaskField() {
            const taskDiv = document.createElement('div');
            taskDiv.className = 'flex items-center mb-2';
            taskDiv.innerHTML = `
                <input type="text" class="flex-grow bg-dark border border-gray-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-nature-500" placeholder="Deskripsi kegiatan">
                <button type="button" class="ml-2 text-red-400 hover:text-red-300 text-lg remove-task-btn">
                    <i class="fas fa-times"></i>
                </button>
            `;
            tasksContainer.appendChild(taskDiv);
        }
        
        // Open add habit modal
        function openAddModal() {
            // Reset form
            document.getElementById('habitTitle').value = '';
            document.getElementById('habitCategory').value = 'pagi';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
            
            // Reset task fields (preserve at least one)
            tasksContainer.innerHTML = '';
            addTaskField();
            
            addModal.classList.remove('hidden');
        }
        
        // Close add habit modal
        function closeAddModal() {
            addModal.classList.add('hidden');
        }
        
        // Open settings modal
        function openSettingsModal() {
            if (githubConfig) {
                document.getElementById('githubUsername').value = githubConfig.username || '';
                document.getElementById('githubRepo').value = githubConfig.repo || '';
                document.getElementById('githubToken').value = githubConfig.token || '';
            }
            settingsModal.classList.remove('hidden');
        }
        
        // Close settings modal
        function closeSettingsModal() {
            settingsModal.classList.add('hidden');
        }
        
        // Save new habit
        function saveHabit(e) {
            e.preventDefault();
            
            const title = document.getElementById('habitTitle').value.trim();
            const category = document.getElementById('habitCategory').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            const taskInputs = tasksContainer.querySelectorAll('input');
            const tasks = Array.from(taskInputs).map(input => ({
                name: input.value.trim(),
                completed: false
            })).filter(task => task.name !== '');
            
            if (!title) {
                showNotification('Judul kegiatan tidak boleh kosong!');
                return;
            }
            
            if (tasks.length === 0) {
                showNotification('Setidaknya tambahkan satu kegiatan!');
                return;
            }
            
            const newHabit = {
                id: Date.now(),
                title,
                tasks,
                category,
                startTime,
                endTime
            };
            
            habits.push(newHabit);
            localStorage.setItem('habits', JSON.stringify(habits));
            
            closeAddModal();
            renderHabits();
            updateCharts();
            
            // Save to GitHub if configured
            if (githubConfig) {
                saveToGitHub();
            }
            
            showNotification('Kegiatan baru berhasil ditambahkan!');
        }
        
        // Delete a habit
        function deleteHabit(id) {
            habits = habits.filter(habit => habit.id !== parseInt(id));
            localStorage.setItem('habits', JSON.stringify(habits));
            renderHabits();
            updateCharts();
            
            // Save to GitHub if configured
            if (githubConfig) {
                saveToGitHub();
            }
            
            showNotification('Kegiatan berhasil dihapus!');
        }
        
        // Toggle task completion
        function toggleTask(habitId, taskIndex) {
            const habit = habits.find(h => h.id === parseInt(habitId));
            if (habit) {
                habit.tasks[taskIndex].completed = !habit.tasks[taskIndex].completed;
                localStorage.setItem('habits', JSON.stringify(habits));
                updateCharts();
                
                // Save to GitHub if configured
                if (githubConfig) {
                    saveToGitHub();
                }
            }
        }
        
        // Save GitHub configuration
        function saveGithubConfig(e) {
            e.preventDefault();
            
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repo || !token) {
                showNotification('Semua field harus diisi!');
                return;
            }
            
            githubConfig = { username, repo, token };
            localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            closeSettingsModal();
            showNotification('Pengaturan GitHub berhasil disimpan!');
        }
        
        // Save data to GitHub
        async function saveToGitHub() {
            if (!githubConfig) return;
            
            try {
                const response = await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/habits.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: 'Update habits data',
                        content: btoa(JSON.stringify(habits)),
                        sha: '' // We don't know the existing SHA
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Gagal menyimpan ke GitHub: ${errorData.message}`);
                }
                
                console.log('Data berhasil disimpan ke GitHub');
            } catch (error) {
                console.error('Error saving to GitHub:', error);
                showNotification(`Gagal menyimpan ke GitHub: ${error.message}`);
            }
        }
        
        // Render habits list
        function renderHabits() {
            if (habits.length === 0) {
                emptyState.classList.remove('hidden');
                habitsContainer.classList.add('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            habitsContainer.classList.remove('hidden');
            
            // Sort habits by custom category order
            const categoryOrder = ['subuh', 'pagi', 'siang', 'sore', 'malam'];
            const sortedHabits = [...habits].sort((a, b) => {
                return categoryOrder.indexOf(a.category) - categoryOrder.indexOf(b.category);
            });
            
            habitsContainer.innerHTML = sortedHabits.map(habit => `
                <div class="habit-card rounded-xl p-5 shadow-lg" data-habit-id="${habit.id}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-lg truncate">${habit.title}</h3>
                            
                            <div class="flex items-center mt-2 mb-4">
                                <span class="category-badge ${
                                    habit.category === 'subuh' ? 'bg-blue-900 text-blue-300 border-blue-700' :
                                    habit.category === 'pagi' ? 'bg-amber-900 text-amber-300 border-amber-700' :
                                    habit.category === 'siang' ? 'bg-yellow-900 text-yellow-300 border-yellow-700' :
                                    habit.category === 'sore' ? 'bg-orange-900 text-orange-300 border-orange-700' :
                                    'bg-purple-900 text-purple-300 border-purple-700'
                                }">
                                    ${habit.category.charAt(0).toUpperCase() + habit.category.slice(1)}
                                </span>
                                ${habit.startTime ? `<span class="ml-3 text-sm text-gray-400"><i class="fas fa-clock mr-1"></i> ${formatTimeRange(habit.startTime, habit.endTime)}</span>` : ''}
                            </div>
                            
                            <div class="mt-4">
                                ${habit.tasks.map((task, index) => `
                                    <div class="flex items-center py-2 border-b border-gray-800 last:border-b-0">
                                        <label class="flex items-center w-full">
                                            <input type="checkbox" class="task-checkbox mr-3 h-5 w-5 rounded focus:ring-nature-500 bg-dark border-gray-600" 
                                                   data-task-id="${index}" ${task.completed ? 'checked' : ''}>
                                            <span class="${task.completed ? 'line-through text-gray-500' : 'text-gray-300'}">${task.name}</span>
                                        </label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <button class="delete-btn text-gray-500 hover:text-red-500 transition ml-3">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Update the charts
        function updateCharts() {
            // Calculate category distribution
            const categoryCounts = {
                subuh: 0,
                pagi: 0,
                siang: 0,
                sore: 0,
                malam: 0
            };
            
            habits.forEach(habit => {
                if (categoryCounts.hasOwnProperty(habit.category)) {
                    categoryCounts[habit.category]++;
                }
            });
            
            // Calculate completion percentage
            const totalTasks = habits.reduce((sum, habit) => sum + habit.tasks.length, 0);
            const completedTasks = habits.reduce((sum, habit) => {
                return sum + habit.tasks.filter(task => task.completed).length;
            }, 0);
            
            const completionPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // Category chart data
            const categoryLabels = Object.keys(categoryCounts).map(cat => cat.charAt(0).toUpperCase() + cat.slice(1));
            const categoryData = Object.values(categoryCounts);
            const categoryColors = ['#3498db', '#f39c12', '#f1c40f', '#e67e22', '#9b59b6'];
            
            // Destroy existing charts if they exist
            if (categoryChart) categoryChart.destroy();
            if (completionChart) completionChart.destroy();
            
            // Create category distribution chart
            categoryChart = new Chart(categoryChartCtx, {
                type: 'doughnut',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryData,
                        backgroundColor: categoryColors,
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e2e8f0',
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw} kegiatan`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
            
            // Create completion percentage chart
            completionChart = new Chart(completionChartCtx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [completionPercentage, 100 - completionPercentage],
                        backgroundColor: ['#3aab76', '#3c4a5c'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataIndex === 0 
                                        ? ` ${context.raw}% selesai` 
                                        : ` ${context.raw}% belum selesai`;
                                }
                            }
                        }
                    },
                    cutout: '70%'
                }
            });
        }
        
        // Helper function to format time range
        function formatTimeRange(start, end) {
            if (!start && !end) return '';
            return `${formatTime(start)}${end ? ` - ${formatTime(end)}` : ''}`;
        }
        
        // Helper function to format time
        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            return `${hours}:${minutes}`;
        }
        
        // Show notification
        function showNotification(message) {
            // In a real app, we might use a more sophisticated notification system
            alert(message);
        }
    </script>
</body>
</html>